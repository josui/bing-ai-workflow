---
name: git-commit
description: 当用户请求 commit、提交代码、git commit 时触发。自动分析变更并生成规范的提交信息，支持多 commit 拆分。
---

# Git Commit

> 自动帮助创建专业的 git commits，遵循项目约定。

## 概述

当用户请求提交代码时触发此技能。自动分析变更内容，判断是否需要拆分为多个 commit，并生成符合规范的提交信息。

## 核心工作流程

### 第一步:分析变更

```bash
# 查看当前状态和改动
git status && git diff --stat && git diff
```

**判断提交策略:**

- **单个 commit**: 所有改动服务于同一目的(功能、修复或优化)
- **多个 commits**: 包含独立功能、不同类型改动、或可分离的修改

**拆分原则:**

1. 功能性改动独立提交
2. Bug 修复独立提交
3. 文档/配置独立提交
4. 样式调整可合并到相关功能
5. **不同模块/目的的改动必须拆分** (即使都是优化/更新)

**判断是否应该拆分的关键问题:**

- 这些改动是否服务于同一个目的？
- 如果要回滚，是否需要一起回滚？
- 改动是否影响同一个功能模块？

如果答案是"否"，则应该拆分。

**应该拆分的场景:**

- 新功能 + 旧功能优化 → 2 commits
- 功能改动 + Bug 修复 → 2 commits
- 代码逻辑 + 文档更新 → 2 commits
- **不同模块的优化** → 多个 commits (如: 开发工具改动 + 业务页面改动 + 依赖更新)
- **不同类型的配置/工具改动** → 多个 commits (如: Prettier 配置 + ESLint 配置)

**可以合并的场景:**

- 组件代码 + 组件样式 → 1 commit
- 功能代码 + 功能测试 → 1 commit

**特殊场景: 部分提交**

如果用户明确指定只提交部分文件(例如"只提交 stylelint 配置"、"先提交配置部分"):

1. **识别用户意图**:
   - "只提交配置" → 只提交配置文件
   - "先提交 stylelint" → 只提交 stylelint 相关文件
   - "暂不提交 unit4" → 排除 unit4 相关文件

2. **只添加相关文件并提交**:

   ```bash
   # 示例: 只提交 stylelint 配置
   git add .stylelintrc.json .vscode/settings.json package.json pnpm-lock.yaml
   git commit -m "chore: 集成 Stylelint"
   ```

3. **提交后告知**:
   - 哪些文件已提交
   - 哪些文件未提交(仍在工作区)
   - 询问是否继续提交其他改动

---

### 第二步:生成提交信息

#### 格式规范

```
<type>: <简洁的描述>

- <详细说明 1>
- <详细说明 2>
- <详细说明 3>
```

#### Type 分类

| Type       | 使用场景                      | 示例                       |
| ---------- | ----------------------------- | -------------------------- |
| `add`      | 新增功能/组件/文件/页面       | add: 新增用户登录功能      |
| `update`   | 更新/优化/改进现有功能        | update: 优化图片加载性能   |
| `fix`      | 修复 bug/错误                 | fix: 修复移动端布局错误    |
| `docs`     | 文档变更/注释                 | docs: 更新 API 使用说明    |
| `style`    | 代码格式/样式调整(不影响逻辑) | style: 统一代码缩进格式    |
| `refactor` | 重构代码(不改变功能)          | refactor: 重构用户认证模块 |
| `chore`    | 构建/工具/依赖更新            | chore: 更新 React 至 18.3  |

#### 格式要求

- 首行 < 50 字符(中文约 25 字)
- 详细说明使用列表(- 开头)
- 每条说明清晰具体
- ❌ **严禁任何 AI 痕迹**
  - 禁止: "根据分析"、"建议"、"优化"等 AI 措辞
  - 禁止: "Generated by AI"、"🤖"、"Claude Code"、"Co-Authored-By: Claude"
  - 禁止: 任何暗示由 AI 生成的内容

---

### 第三步:文档同步（fix/refactor 时）

**在执行 commit 前**，根据提交类型判断是否需要更新文档：

**需要执行 /aidoc 的情况：**

- `add`、`update` 类型提交（更新 README、CLAUDE、AGENT 相关文档）
- `fix` 类型提交（可能需要记录到「已知陷阱」）
- `refactor` 类型提交（可能产生新的「成功模式」）
- 当前 session 中出现代码回滚或拒绝方案时总结陷阱

**流程：**

1. 确认提交类型为 fix/refactor
2. 询问用户："本次是 fix/refactor 类型，是否需要执行 /aidoc 更新文档？"
3. 如果用户同意，执行 /aidoc
4. aidoc 产生的文档修改将和代码改动一起提交

**不需要执行的情况：**

- `add`、`update`、`docs`、`style`、`chore` 类型
- 用户明确拒绝

---

### 第四步:执行提交

**单个 commit - 多行消息** (推荐):

```bash
git add <files>
git commit -m "$(cat <<'EOF'
add: 新增 pricing 组件

- 三栏价格表布局,支持月付/年付切换
- 使用 CSS 变量实现主题定制
EOF
)"
```

**单个 commit - 单行消息**:

```bash
git add <files>
git commit -m "fix: 修复图片路径错误"
```

**多个 commits - 连续提交示例**:

```bash
# 改动: 新组件 + 文档 + bug修复

# Commit 1: 新功能
git add src/components/NewsCard/ src/pages/news.astro
git commit -m "add: 新增 NewsCard 组件"

# Commit 2: 修复
git add src/utils/date.ts
git commit -m "fix: 修复日期格式化问题"

# Commit 3: 文档
git add README.md
git commit -m "docs: 更新组件说明"
```

---

### 第五步:验证提交

```bash
git log -1 --format="%C(yellow)%h%Creset - %s%n%b"
git status
```
