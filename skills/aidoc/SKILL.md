---
name: aidoc
description: 当用户请求更新文档、整理文档时触发。项目文档整理与更新，实现 AI 友好的渐进式披露。
---

# AI 文档整理与更新

> 用户输入 `/aidoc` 时触发。软触发提醒由 `git-commit` skill 负责。

## 概述

维护项目的 AI 配置文件（如 CLAUDE.md、AGENTS.md）和组件 README，确保文档结构清晰、信息渐进式披露。

## 职责范围

1. **文档整理**
   - 优化 AI 配置文件结构（渐进式披露）
   - 从 git 历史提取陷阱和模式
   - 检查文档层级是否合理

2. **文档更新**
   - 识别本次修改涉及的文件夹
   - 检查对应 README 是否需要更新
   - 提供更新建议

## 各 AI 工具配置文件

不同 AI 编码工具使用不同的配置文件：

| 工具 | 配置文件 | 位置 |
|------|----------|------|
| Claude Code | `CLAUDE.md` | 项目根目录或 `.claude/` |
| OpenAI Codex CLI | `AGENTS.md` | 项目根目录，支持目录层级 |
| Google Gemini CLI | `GEMINI.md` | 项目根目录或 `~/.gemini/`（全局） |
| OpenCode | `AGENTS.md` | 项目根目录或 `.opencode/` |

**说明：**
- 本 skill 中提到的"AI 配置文件"泛指上述任一工具的配置文件
- 根据当前使用的工具选择对应文件进行维护

## 执行步骤

1. 读取项目 AI 配置文件了解项目规则
2. 检查配置文件行数和结构
3. 从 git log 识别 fix/refactor 提交
4. 评估是否需要：
   - 更新「已知陷阱」或「成功模式」
   - 外链（超过阈值时）
   - 更新组件 README
5. 生成文档更新建议或直接执行

## 与项目规则的关系

- **项目硬规则**：保留在 AI 配置文件中（如代码规范、同步要求）
- **aidoc**：提供流程指导和执行辅助，不替代项目规则

## 外链策略

> 遵循渐进式披露原则：首次接触只需核心信息，深入时再展开细节

**阈值判断（软硬双阈值）**

| 阈值 | 条件 | 动作 |
|------|------|------|
| 软阈值 | 配置文件 >200 行 或 陷阱+模式合计 >12 条 | 建议外链 |
| 硬阈值 | 配置文件 >300 行 | 必须外链 |

**外链方法（索引 + 就近原则）**

1. **Level 2 就近原则**（优先）
   - 组件强相关陷阱 → 放入组件 README
   - 例：表单验证问题 → `src/components/forms/README.md`

2. **索引页 + 可选分文件**（通用陷阱）

   ```
   doc/traps/
   ├── index.md       # 总索引（带 tags）
   └── components/    # 可选：按组件细分
       ├── auth.md
       └── forms.md

   doc/patterns/
   └── index.md       # 成功模式索引
   ```

**配置文件保留策略**

- 保留最近/最重要的 5 条摘要
- 添加指针：`> 完整列表见 doc/traps/index.md`

**外链后的配置文件示例**

```markdown
## 已知陷阱（复利工程）

> 记录标准：(1) 可能再犯 (2) 有通用性 (3) 违反直觉
> 完整列表见 `doc/traps/index.md`

| 问题 | 正确做法 | 来源 |
|------|----------|------|
| （最近 5 条摘要） | ... | ... |
```

**index.md 格式示例**

```markdown
# 已知陷阱索引

| 问题 | 正确做法 | 来源 | 标签 |
|------|----------|------|------|
| 状态未重置 | 组件卸载时清理 | fix: 6f02dcb | hooks |
| 类型推断失败 | 显式声明泛型 | refactor: 79a0d6e | typescript |
```
